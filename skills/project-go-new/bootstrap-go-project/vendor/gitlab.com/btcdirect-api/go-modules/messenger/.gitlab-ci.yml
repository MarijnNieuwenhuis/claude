stages:
    - test

test:
    stage: test
    image: golang:1.22.0-alpine
    script:
        - go test -v -coverprofile=coverage.out ./...
    coverage: '/coverage: \d+.\d+% of statements/'
    rules:
        - if: $CI_PIPELINE_SOURCE == "web"
        - if: $CI_PIPELINE_SOURCE == "merge_request_event"
        - if: $CI_COMMIT_TAG
    extends:
        - .retry

.retry:
    retry:
        max: 2
        when:
            - runner_system_failure
